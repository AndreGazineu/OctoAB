<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Octo A/B Test</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
</head>
<body>
<style>

    body {
        font-family: Georgia, serif;
        background: #fdf6e3;
        color: #073642;
        margin: 0;
        padding: 0;
    }
    header {
        text-align: center;
        padding: 1rem;
        font-size: 2rem;
        background: #268bd2;
        color: #fdf6e3;
        margin-bottom: 1rem;
    }
    .container {
        max-width: 960px;
        margin: auto;
        padding: 2rem;
        background: #fdf6e3;
        box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .1);
    }
    .image-boxes,
    .progress-box,
    .result-box {
        width: 100%;
        text-align: center;
        margin-bottom: 1rem;
    }
    .image-box {
        display: inline-block;
        margin: 0 1rem;
    }
    input[type=file] {
        display: none;
    }
    .custom-file-upload {
        border: .125rem solid #268bd2;
        padding: .5rem 1rem;
        cursor: pointer;
        color: #268bd2;
    }
    .result-box {
        background: #fdf6e3;
        padding: 1rem;
        border: .0625rem solid #93a1a1;
        border-radius: .5rem;
    }
    .result {
        font-size: 3rem;
        margin-top: .5rem;
        color: #268bd2;
    }
    button {
        background: #268bd2;
        border: none;
        color: #fdf6e3;
        padding: .75rem 1.5rem;
        font-size: 1rem;
        border-radius: .375rem;
        transition: background .3s;
    }
    button:hover {
        background: #2076b9;
    }
    progress {
        width: 100%;
        margin-top: 1rem;
    }
    .tinder-button {
        background: 0 0;
        border: none;
        font-size: 2rem;
        padding: .5rem;
        border-radius: 50%;
        transition: background .3s;
    }
    .tinder-button:hover {
        cursor: pointer;
    }
    .yes-button:hover {
        background: #859900;
    }
    .no-button:hover {
        background: #dc322f;
    }
    .octopus-container {
        font-size: 50px;
        position: relative;
        text-align: center;
        margin-top: 2rem;
    }
    .thought-bubble {
        width: 40px;
        height: 40px;
        background-color: #fff;
        border-radius: 50%;
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        animation: bubbleAnimation 3s infinite;
    }
    @keyframes bubbleAnimation {
        0%,
        100% {
            opacity: 0;
            transform: translateX(-50%) scale(.5);
        }
        50% {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }
    }
        .language-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    </style>

</head>
<body onload="loadModel()">
    <header>
        <span id="header-title">Octo A/B Test</span> <!-- Adicionado um ID para facilitar a sele√ß√£o -->
        <div class="language-selector" onclick="toggleLanguage()">
            <span id="language">EN</span>
        </div>
    </header>
    <div class="container">
        <div class="octopus-container">üêô
            <div class="thought-bubble"></div>
        </div>
    </div>
    <div class="container">
        <div class="image-boxes">
            <div class="image-box">
                <label for="imageA" class="custom-file-upload" id="label-imageA">Image A</label>
                <input type="file" id="imageA" accept="image/*" onchange="displayThumbnail(this, 'thumbA')">
                <canvas id="thumbA" width="100" height="100"></canvas>
            </div>
            <div class="image-box">
                <label for="imageB" class="custom-file-upload" id="label-imageB">Image B</label>
                <input type="file" id="imageB" accept="image/*" onchange="displayThumbnail(this, 'thumbB')">
                <canvas id="thumbB" width="100" height="100"></canvas>
            </div>
        </div>
        <button onclick="processImages()" id="process-button">Process</button>
        <div class="progress-box">
            <progress id="progressBar" value="0" max="100"></progress>
        </div>
        <div class="result-box">
            <div class="result" id="result"></div>
            <p id="like-chosen-image">Like the chosen image?</p>
            <button class="tinder-button yes-button" onclick="userAgreed(true)">‚ù§Ô∏è</button>
            <button class="tinder-button no-button" onclick="userAgreed(false)">‚ùå</button>
        </div>
    </div>
    <footer id="footer" style="background-color:#268bd2;color:#fdf6e3;padding:1rem;text-align:center">
        <h3 id="footer-title">O Octo A/B Test utiliza uma moderna arquitetura de machine learning</h3>
        <p id="footer-text">O algoritmo determina qual imagem mais ativa a rede de sali√™ncia no ser humano. Cada imagem recebe uma "pontua√ß√£o de sali√™ncia" com base na ativa√ß√£o de v√°rias camadas do modelo de rede neural. O algoritmo compara as pontua√ß√µes das duas imagens e decide qual delas chama mais aten√ß√£o.</p>
    </footer>
    <div class="container" style="text-align:center;">
        <img src="https://uploaddeimagens.com.br/images/004/633/148/original/Upload.jpeg?1696944052" alt="Upload" style="width:30%; margin:1%;">
        <img src="https://uploaddeimagens.com.br/images/004/633/151/original/Process.jpeg?1696944082" alt="Process" style="width:30%; margin:1%;">
        <img src="https://uploaddeimagens.com.br/images/004/633/140/original/Feedback.jpeg?1696943909" alt="Feedback" style="width:30%; margin:1%;">
    </div>

    <!-- Inclus√£o das instru√ß√µes -->
    <div class="container" id="instructions-container">
        <!-- As IDs espec√≠ficas ser√£o √∫teis para a tradu√ß√£o -->
        <h3 id="instructions-title">Como Utilizar o Modelo para Comparar Imagens</h3>
        <ol id="instructions-list">
            <li id="instructions-step1">Carregar Imagens: Selecione duas imagens diferentes clicando nos bot√µes 'Imagem A' e 'Imagem B'.</li>
            <li id="instructions-step2">Processar Imagens: Clique em ‚ÄòProcessar‚Äô para iniciar a an√°lise. O modelo identificar√° qual imagem √© mais atraente.</li>
            <li id="instructions-step3">Visualizar Resultado: Veja o resultado exibido abaixo do bot√£o 'Processar'. A imagem "melhor" ser√° indicada.</li>
            <li id="instructions-step4">Dar Feedback: Clique em ‚ù§Ô∏è ou ‚ùå para concordar ou discordar do resultado.</li>
            <li id="instructions-step5">Repetir: Para analisar outro conjunto de imagens, repita os passos 1-4.</li>
        </ol>
    </div>
    <script>
        let currentLanguage = 'EN';

        const translations = {
            'EN': {
                'headerTitle': 'Octo A/B Test',
                'imageA': 'Image A',
                'imageB': 'Image B',
                'process': 'Process',
                'likeChosenImage': 'Like the chosen image?',
                'footerTitle': 'Octo A/B Test uses a modern machine learning architecture',
                'footerText': 'The algorithm determines which image most activates the salience network in humans. Each image receives a "salience score" based on the activation of various layers of the neural network model. The algorithm compares the scores of the two images and decides which one attracts more attention.'
            },
            'PT': {
                'headerTitle': 'Octo A/B Teste',
                'imageA': 'Imagem A',
                'imageB': 'Imagem B',
                'process': 'Processar',
                'likeChosenImage': 'Gostou da imagem escolhida?',
                'footerTitle': 'O Octo A/B Test utiliza uma moderna arquitetura de machine learning',
                'footerText': 'O algoritmo determina qual imagem mais ativa a rede de sali√™ncia no ser humano. Cada imagem recebe uma "pontua√ß√£o de sali√™ncia" com base na ativa√ß√£o de v√°rias camadas do modelo de rede neural. O algoritmo compara as pontua√ß√µes das duas imagens e decide qual delas chama mais aten√ß√£o.'
}
};

    function toggleLanguage() {
        currentLanguage = currentLanguage === 'EN' ? 'PT' : 'EN';
        document.getElementById('language').innerText = currentLanguage;
        updateLanguage();
    }

    function updateLanguage() {
        const translation = translations[currentLanguage];
        document.getElementById('header-title').innerText = translation.headerTitle;
        document.getElementById('label-imageA').innerText = translation.imageA;
        document.getElementById('label-imageB').innerText = translation.imageB;
        document.getElementById('process-button').innerText = translation.process;
        document.getElementById('like-chosen-image').innerText = translation.likeChosenImage;
        document.getElementById('footer-title').innerText = translation.footerTitle;
        document.getElementById('footer-text').innerText = translation.footerText;
    }

    window.onload = function() {
        updateLanguage(); // Atualiza o idioma na carga da p√°gina
    }
        const instructionsTranslations = {
            'EN': {
                'instructionsTitle': 'How to Use the Model to Compare Images',
                'instructionsStep1': 'Load Images: Select two different images by clicking on the \'Image A\' and \'Image B\' buttons.',
                'instructionsStep2': 'Process Images: Click on ‚ÄòProcess‚Äô to start the analysis. The model will identify which image is more appealing.',
                'instructionsStep3': 'View Result: See the result displayed below the \'Process\' button. The "better" image will be indicated.',
                'instructionsStep4': 'Give Feedback: Click on ‚ù§Ô∏è or ‚ùå to agree or disagree with the result.',
                'instructionsStep5': 'Repeat: To analyze another set of images, repeat steps 1-4.'
            },
            'PT': {
                'instructionsTitle': 'Como Utilizar o Modelo para Comparar Imagens',
                'instructionsStep1': 'Carregar Imagens: Selecione duas imagens diferentes clicando nos bot√µes \'Imagem A\' e \'Imagem B\'.',
                'instructionsStep2': 'Processar Imagens: Clique em ‚ÄòProcessar‚Äô para iniciar a an√°lise. O modelo identificar√° qual imagem √© mais atraente.',
                'instructionsStep3': 'Visualizar Resultado: Veja o resultado exibido abaixo do bot√£o \'Processar\'. A imagem "melhor" ser√° indicada.',
                'instructionsStep4': 'Dar Feedback: Clique em ‚ù§Ô∏è ou ‚ùå para concordar ou discordar do resultado.',
                'instructionsStep5': 'Repetir: Para analisar outro conjunto de imagens, repita os passos 1-4.'
            }
        };

        function updateInstructionsLanguage() {
            const translation = instructionsTranslations[currentLanguage];
            document.getElementById('instructions-title').innerText = translation.instructionsTitle;
            document.getElementById('instructions-step1').innerText = translation.instructionsStep1;
            document.getElementById('instructions-step2').innerText = translation.instructionsStep2;
            document.getElementById('instructions-step3').innerText = translation.instructionsStep3;
            document.getElementById('instructions-step4').innerText = translation.instructionsStep4;
            document.getElementById('instructions-step5').innerText = translation.instructionsStep5;
        }

        window.onload = function() {
            updateLanguage();
            updateInstructionsLanguage(); // Adiciona esta linha para atualizar o idioma das instru√ß√µes na carga da p√°gina
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'EN' ? 'PT' : 'EN';
            document.getElementById('language').innerText = currentLanguage;
            updateLanguage();
            updateInstructionsLanguage(); // Adiciona esta linha para atualizar o idioma das instru√ß√µes quando o idioma √© alternado
        }
</script>

    <script>
        let model;

        function updateProgressBar(value) {
            const progressBar = document.getElementById('progressBar');
            progressBar.value = value;
        }

        async function loadModel() {
            updateProgressBar(10);
            model = await tf.loadLayersModel('https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json');
            updateProgressBar(100);
            console.log("Model loaded", model); // Adiciona esta linha
        }

        function userAgreed(decision) {
            console.log(`O usu√°rio ${decision ? 'concorda' : 'discorda'}`);
            alert('Obrigado pelo feedback!');
        }

            async function classifyImage(image, canvasId) {
        if (!model) {
            console.error("Modelo n√£o est√° carregado.");
            alert("O modelo ainda est√° carregando. Por favor, aguarde.");
            return;
        }

        updateProgressBar(20);
        const img = new Image();
        img.src = URL.createObjectURL(image);
        await new Promise((resolve) => img.onload = resolve);

        const thumbCanvas = document.getElementById(canvasId);
        const thumbCtx = thumbCanvas.getContext('2d');

        let width = 32;
        let height = 32;
        if (img.width > img.height) {
            height = Math.round((32 * img.height) / img.width);
        } else {
            width = Math.round((32 * img.width) / img.height);
        }

        const x = (32 - width) / 2;
        const y = (32 - height) / 2;

        thumbCtx.drawImage(img, x, y, width, height);

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        const imageData = tf.browser.fromPixels(canvas).resizeNearestNeighbor([224, 224]).toFloat().expandDims();
        const predictions = model.predict(imageData);
        const topPrediction = predictions.as1D().argMax();
        const topPredictionValue = predictions.as1D().max();
        updateProgressBar(50);

        console.log("Predi√ß√£o: ", topPredictionValue.arraySync()); // Adiciona essa linha para debug
        return topPredictionValue.arraySync();
    }

        async function decideBetweenImages(imageA, imageB, thumbA, thumbB) {
            const predA = await classifyImage(imageA, thumbA);
            const predB = await classifyImage(imageB, thumbB);
            if (predA > predB) {
                return 'A';
            } else {
                return 'B';
            }
        }

        async function processImages() {
            updateProgressBar(0);
            const imageA = document.getElementById('imageA').files[0];
            const imageB = document.getElementById('imageB').files[0];

            if (!imageA || !imageB) {
                alert("Por favor, selecione ambas as imagens antes de processar.");
                return;
            }

            if (imageA.name === imageB.name) {
                alert("Por favor, utilize imagens diferentes");
                return;
            }

            const decision = await decideBetweenImages(imageA, imageB, 'thumbA', 'thumbB');
            updateProgressBar(90);
            const resultElement = document.getElementById('result');
            resultElement.textContent = decision === 'A' ? 'Imagem A √© melhor!' : 'Imagem B √© melhor!';
            updateProgressBar(100);
        }

        function displayThumbnail(input, canvasId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = new Image();
                    img.onload = function () {
                        const canvas = document.getElementById(canvasId);
                        const ctx = canvas.getContext('2d');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
    </script>

    <script>
        twemoji.parse(document.body);
    </script>
</body>
</html>
